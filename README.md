# OpenShift Event Watcher

The OpenShift Event Watcher is a utility used as a service integrator for OpenShift and other third party components

## Testing Locally

Log into OpenShift and then run a command like the following

```
OS_TOKEN=`oc whoami -t` OS_API='master.example.com:8443' OS_NAMESPACE=event-watcher SSL_CA_TRUST=./kubernetes.io/serviceaccount/ca.crt OS_RESOURCE=routes python watch.py
```

You should see a log of data about the Namespace you passed in.

## Plugin Architecture

The event watcher is designed to be pluggable. New plugins can be created by simply creating a python module that implements a single `handle_event()` method, which takes a single `dict` object as an argument (the `event` object).

A plugin is invoked like so:

```python
  plugin = load_plugin(plugin_name)
  for k8s_event in getEvents():
    result,level = plugin.handle_event(k8s_event, *args, **kwargs)
    log(result, level)
```

Let's look at a very simple plugin, called `plugin_simple`. This plugin is a single file init file loaded from a directory, `plugin_simple/__init__.py`:

```
def handle_event(event):
    message = "Kind: {0}; Name: {1}".format(event['object']['kind'], event['object']['metadata']['name'])
    log_level = "INFO"
    return message, log_level
```

This plugin takes in the event object generated by the Kubernetes API, grabs a few choice fields, and creates a log message which is returned to the watcher.

From here, we can easily write plugins for the watcher that do things like:

- Create Alerts
- Integrate with Third party systems like DNS or PKI infrastructures

Happy Integrating!
